{% extends "page_layout/layout.html" %}

{% block title %} {{ super() }} {{translation.employee_profile[language]}} {% endblock %}
{% block css_or_js_code %}
    <style>
      [type=radio]:not(:checked).rd, [type=radio]:checked.rd {
          position: absolute !important;
          left: auto;
          opacity: 1 !important;
      }
      li.nav-item{
        margin-right: -1px !important;
      }
      .profile li a.nav-link{
        border: none !important;
      }
      .profile li a.nav-link.border-bottom{
        border-bottom: 1px solid #d9d9d9 !important;
      }
      .profile li a.nav-link.border-radius-top{
        border-top-left-radius: 10px;
        border-top-right-radius: 10px;
      }
      .profile li a.nav-link.border-radius-bottom{
        border-bottom-left-radius: 10px;
        border-bottom-right-radius: 10px;
      }
      .profile ul.nav{
        border: 1px solid #d9d9d9;
        border-radius: 10px;
      }
      .profile .border-radius{
        border: 1px solid #d9d9d9;
        border-radius: 10px;
      }
    </style>
{% endblock  css_or_js_code %}
{% block main_content %}
<section class="content">
  <div class="row profile">
    <div class="col-xl-9 col-12">
      <div class="row">
            <div class="col-xl-4">
                <div class="info-box pull-up">
                    <span class="info-box-icon bg-primary-light rounded-circle">
                      <i class="far fa-plus-hexagon mt-4"></i>
                    </span>
                    <div class="info-box-content text-right">
                      {% set hourly=[] %}
                      {% set daily=[] %}
                      {% if employee %}
                        {% for overtime in employee.overtimes  %}
                          {% if not overtime.overtime_type %}
                            {% if daily.append((overtime.end_datetime - overtime.start_datetime).days) %}{% endif %}
                          {% else %}
                            {% if hourly.append((overtime.end_datetime - overtime.start_datetime).seconds) %}{% endif %}
                          {% endif %}
                        {% endfor %}
                      {% endif %}
                      <span class="info-box-number">
                        {{ (sum(daily) + ((sum(hourly)/3600)/8)|int) }} {{translation.day[language]}}, {{ ((sum(hourly)/3600) % 8 )|int }}:{{ ((sum(hourly)/60) % 60 )|int }}
                      </span>
                      <span class="info-box-text">{{translation.overtime[language]}}</span>
                    </div>
                </div>
            </div>
            <div class="col-xl-4">
                <div class="info-box pull-up">
                    <span class="info-box-icon bg-primary-light rounded-circle">
                      <i class="far fa-minus-hexagon mt-4"></i>
                    </span>
                    {% set hourly=[] %}
                    {% set daily=[] %}
                    {% if employee %}
                      {% for leave in employee.leaves  %}
                        {% if not leave.leave_type %}
                          {% if daily.append((leave.end_datetime - leave.start_datetime).days) %}{% endif %}
                        {% else %}
                          {% if hourly.append((leave.end_datetime - leave.start_datetime).seconds) %}{% endif %}
                        {% endif %}
                      {% endfor %}
                    {% endif %}
                    <div class="info-box-content text-right">
                      <span class="info-box-number">{{ (sum(daily) + ((sum(hourly)/3600)/8)|int) }} {{translation.day[language]}}, {{ ((sum(hourly)/3600) % 8 )|int }}:{{ ((sum(hourly)/60) % 60 )|int }}</span>
                      <span class="info-box-text">{{translation.leave[language]}}</span>
                    </div>
                </div>
            </div>
            <div class="col-xl-4">
                <div class="info-box pull-up">
                  <span class="info-box-icon bg-primary-light rounded-circle">
                    <i class="fas fa-hand-holding-usd mt-4"></i>
                  </span>
                  {% set amounts=[] %}
                  {% if employee %}
                    {% for loan in employee.loans %}
                      {% if amounts.append((loan.requested_amount)) %}{% endif %}
                    {% endfor %}
                  {% endif %}
                  <div class="info-box-content text-right">
                    <span class="info-box-number">{{ sum(amounts) }}</span>
                    <span class="info-box-text">{{translation.loan[language]}}</span>
                  </div>
                </div>
            </div>
        </div>
        <div class="box">
          <div class="col-12">
            <div class="box box-default">
              <div class="box-header with-border">
                <h4 class="box-title">{{translation.employee_profile[language]}}</h4>
              </div>
              <!-- /.box-header -->
                <div class="box-body">
                <ul class="nav nav-tabs nav-fill" role="tablist">
                    <li class="nav-item">
                      <a class="nav-link border-bottom border-radius-top active" data-toggle="tab" href="#personal_info" role="tab">
                        <span>{{translation.personal_information[language]}}</span>
                      </a>
                    </li>
                    <li class="nav-item">
                      <a class="nav-link border-bottom" data-toggle="tab" href="#addresses" role="tab">
                        <span>{{translation.address[language]}}</span>
                      </a>
                    </li>
                    <li class="nav-item">
                      <a class="nav-link border-bottom" data-toggle="tab" href="#documents" role="tab">
                        <span>{{translation.documents[language]}}</span>
                      </a>
                    </li>
                    <li class="nav-item">
                      <a class="nav-link border-bottom" data-toggle="tab" href="#contact" role="tab">
                        <span>{{translation.call[language]}}</span>
                      </a>
                    </li>
                    <li class="nav-item">
                      <a class="nav-link border-radius-bottom" data-toggle="tab" href="#contract" role="tab">
                        <span>{{translation.contract[language]}}</span>
                      </a>
                    </li>
                </ul>
                <!-- Tab panes -->
                <div class="tab-content tabcontent-border">
                    <div class="tab-pane active" id="home11" role="tabpanel">
                      <div class="row">
                        <div class="col-md-6">
                          <div class="box border-radius">
                            <div class="box-body">
                              <h4>نام به دری</h4>
                              <div class="bg-white pt-2">
                                <div class="media-body m-1 p-1 bb-1">
                                    <span>نام</span>
                                    <strong class="float-right">
                                    {{ employee.name }}
                                    </strong>
                                </div>
                              </div>
                              <div class="bg-white pt-2">
                                <div class="media-body m-1 p-1 bb-1">
                                    <span>تخلص</span>
                                    <strong class="float-right">
                                    {{ employee.lname }}
                                    </strong>
                                </div>
                              </div>
                              <div class="bg-white pt-2">
                                <div class="media-body m-1 p-1 bb-1">
                                    <span>نام پدر</span>
                                    <strong class="float-right">
                                    {{ employee.fname }}
                                    </strong>
                                </div>
                              </div>
                              <div class="bg-white pt-2">
                                <div class="media-body m-1 p-1 bb-1">
                                    <span>نام پدر کلان</span>
                                    <strong class="float-right">
                                    {{ employee.gname }}
                                    </strong>
                                </div>
                              </div>
                            </div>
                          </div>
                        </div>
                        <div class="col-md-6">
                          <div class="box border-radius">
                            <div class="box-body">
                              <h4>Name in English</h4>
                              <div class="bg-white pt-2">
                                <div class="media-body m-1 p-1 bb-1">
                                    <span>First Name</span>
                                    <strong class="float-right">
                                    {{ employee.name_english }}
                                    </strong>
                                </div>
                              </div>
                              <div class="bg-white pt-2">
                                <div class="media-body m-1 p-1 bb-1">
                                    <span>Last Name</span>
                                    <strong class="float-right">
                                    {{ employee.lname_english }}
                                    </strong>
                                </div>
                              </div>
                              <div class="bg-white pt-2">
                                <div class="media-body m-1 p-1 bb-1">
                                    <span>Father Name</span>
                                    <strong class="float-right">
                                    {{ employee.fname_english }}
                                    </strong>
                                </div>
                              </div>
                              <div class="bg-white pt-2">
                                <div class="media-body m-1 p-1 bb-1">
                                    <span>Grand Father Name</span>
                                    <strong class="float-right">
                                    {{ employee.gname_english }}
                                    </strong>
                                </div>
                              </div>
                            </div>
                          </div>
                        </div>
                      </div>
                      <div class="box border-radius">
                        <div class="box-body">
                          <div class="row">
                            <div class="col-md-6">
                              <div class="bg-white pt-2">
                                <div class="media-body m-1 p-1 bb-1">
                                    <span>{{ translation.tazkira[language] }}</span>
                                    <strong class="float-right">
                                    {{ employee.tazkira }}
                                    </strong>
                                </div>
                              </div>
                            </div>
                            <div class="col-md-6">
                              <div class="bg-white pt-2">
                                <div class="media-body  m-1 p-1 bb-1">
                                    <span>{{ translation.tin[language] }}</span>
                                    <strong class="float-right">
                                    {{ employee.tin }}
                                    </strong>
                                </div>
                              </div>
                            </div>
                            <div class="col-md-6">
                              <div class="bg-white pt-2">
                                <div class="media-body  m-1 p-1 bb-1">
                                    <span>{{ translation.birthday[language] }}</span>
                                    <strong class="float-right">
                                    {{ to_jalali(employee.birthday) }}
                                    </strong>
                                </div>
                              </div>
                            </div>
                            <div class="col-md-6">
                              <div class="bg-white pt-2">
                                <div class="media-body  m-1 p-1 bb-1">
                                    <span>{{ translation.blood_group[language] }}</span>
                                    <strong class="float-right">
                                    {{ employee.blood }}
                                    </strong>
                                </div>
                              </div>
                            </div>
                            <div class="col-md-6">
                              <div class="bg-white pt-2">
                                <div class="media-body  m-1 p-1 bb-1">
                                    <span>{{ translation.m_status[language] }}</span>
                                    <strong class="float-right">
                                    {% if employee.gender == true %}
                                      {{translation.male[language]}}
                                    {% else %}
                                      {{translation.female[language]}}
                                    {% endif %}
                                    </strong>
                                </div>
                              </div>
                            </div>
                            <div class="col-md-6">
                              <div class="bg-white pt-2">
                                <div class="media-body  m-1 p-1 bb-1">
                                    <span>{{ translation.status[language] }}</span>
                                    <strong class="float-right">
                                      {% if employee.m_status == True %}
                                        {{translation.married[language]}}
                                      {% else %}
                                        {{translation.single[language]}}
                                      {% endif %}
                                    </strong>
                                </div>
                              </div>
                            </div>
                            <div class="col-md-6">
                              <div class="bg-white pt-2">
                                <div class="media-body overflow-auto m-1 p-1 bb-1">
                                    <span>{{ translation.phone[language] }}</span>
                                    <strong class="float-right text-left">
                                      {% for phone in employee.phones %}
                                        {{ phone.phone }}<br>
                                      {% endfor %}
                                    </strong>
                                </div>
                              </div>
                            </div>
                            <div class="col-md-6">
                              <div class="bg-white pt-2">
                                <div class="media-body overflow-auto mb-1 py-1 bb-1">
                                    <span>{{ translation.email[language] }}</span>
                                    <strong class="float-right text-left">
                                      {% for email in employee.emails %}
                                        {{ email.email }}<br>
                                      {% endfor %}
                                    </strong>
                                </div>
                              </div>
                            </div>
                          </div>
                        </div>
                      </div>
                    </div>
                    <div class="tab-pane" id="profile11" role="tabpanel">
                      
                    </div>
                    <div class="tab-pane" id="messages11" role="tabpanel">
                        
                    </div>
                    <div class="tab-pane" id="setting11" role="tabpanel">

                    </div>
                </div>
              </div>
              <!-- /.box-body -->
            </div>
            <!-- /.box -->
          </div>
        </div>
      </div>
      <div class="col-xl-3 col-12">
        <div class="box">
          <div class="box-body text-center">
              <div class="mb-20 mt-20">
                  <form id="upload_profile_pic" enctype="multipart/form-data">
                      <input type="file" onchange="uploadProfile()" name="profilePic">
                  </form>
                  <img src="{{ employee.profile_pic }}" onerror="this.onerror=null; this.src='/static/images/avatar.png'" width="150" class="rounded-circle bg-info-light" alt="user">
                  <h3 class="mt-10">
                    {% if language == 'dari' %}
                      {{employee.name}} {{employee.lname}}
                    {% else %}
                      {{employee.name_english}} {{employee.lname_english}}
                    {% endif %}
                  </h3>
                  <h4>{{employee.id}}</h4>
              </div>
          </div>
      </div>
   </div>
  </div>
</section>
{% endblock main_content%}
{% block js_code %}
<script>
function uploadProfile(){
        $form = $("#upload_profile_pic");
        var formData = new FormData($form[0]);
        $.ajax({
            type: "POST",
            url: "upload_profile_pic",
            data: formData,
            processData: false,
            contentType: false,
            success: function (response) {
              if(response == "success")
                location.reload()
                toastSuccess(response);
            },
            error: function (response) {
                var statusCode = response.status;
                var r = '';
                if (statusCode == '403') {
                    r = formValidateErrors(response);
                }
                toastError(r);
            }
        });
    };
  
</script>
{% endblock js_code %}