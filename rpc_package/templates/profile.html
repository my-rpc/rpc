{% extends "page_layout/layout.html" %}

{% block title %} {{ super() }} {{translation.employee_profile[language]}} {% endblock %}
{% block css_or_js_code %}
    <style>
      [type=radio]:not(:checked).rd, [type=radio]:checked.rd {
          position: absolute !important;
          left: auto;
          opacity: 1 !important;
      }
      .icon-pointer {
        cursor: pointer;
      }
      .border-radius-dari{
        border-right: none;
        border-radius: 0.25rem 0 0 0.25rem !important;
      }
      .border-radius-en{
        border-left: none;
        border-radius: 0 0.25rem 0.25rem 0 !important;
      }
      .profile li a.nav-link{
        border: none !important;
      }
      .profile li a.nav-link.border-bottom{
        border-bottom: 1px solid #d9d9d9 !important;
      }
      .profile li a.nav-link.border-radius-right{
        border-top-right-radius: 10px;
      }
      .profile li a.nav-link.border-radius-left{
        border-top-left-radius: 10px;
      }
      .profile .border-radius{
        border: 1px solid #d9d9d9;
        border-radius: 10px;
      }
    </style>
{% endblock  css_or_js_code %}
{% block main_content %}
<section class="content">
  <div class="row profile">
    <div class="col-xl-9 col-12">
      <div class="row">
            <div class="col-xl-4">
                <div class="info-box pull-up">
                    <span class="info-box-icon bg-primary-light rounded-circle">
                      <i class="far fa-plus-hexagon mt-4"></i>
                    </span>
                    <div class="info-box-content text-right">
                      {% set hourly=[] %}
                      {% set daily=[] %}
                      {% if employee %}
                        {% for overtime in employee.overtimes.filter_by(hr=1, supervisor=1).all()  %}
                          {% if not overtime.overtime_type %}
                            {% if daily.append((overtime.end_datetime - overtime.start_datetime).days) %}{% endif %}
                          {% else %}
                            {% if hourly.append((overtime.end_datetime - overtime.start_datetime).seconds) %}{% endif %}
                          {% endif %}
                        {% endfor %}
                      {% endif %}
                      <span class="info-box-number">
                        {{ (sum(daily) + ((sum(hourly)/3600)/8)|int) }} {{translation.day[language]}}, {{ ((sum(hourly)/3600) % 8 )|int }}:{{ ((sum(hourly)/60) % 60 )|int }}
                      </span>
                      <span class="info-box-text">{{translation.overtime[language]}}</span>
                    </div>
                </div>
            </div>
            <div class="col-xl-4">
                <div class="info-box pull-up">
                    <span class="info-box-icon bg-primary-light rounded-circle">
                      <i class="far fa-minus-hexagon mt-4"></i>
                    </span>
                    {% set hourly=[] %}
                    {% set daily=[] %}
                    {% if employee %}
                      {% for leave in employee.leaves.filter_by(hr=1, supervisor=1).all()  %}
                        {% if not leave.leave_type %}
                          {% if daily.append((leave.end_datetime - leave.start_datetime).days) %}{% endif %}
                        {% else %}
                          {% if hourly.append((leave.end_datetime - leave.start_datetime).seconds) %}{% endif %}
                        {% endif %}
                      {% endfor %}
                    {% endif %}
                    <div class="info-box-content text-right">
                      <span class="info-box-number">{{ (sum(daily) + ((sum(hourly)/3600)/8)|int) }} {{translation.day[language]}}, {{ ((sum(hourly)/3600) % 8 )|int }}:{{ ((sum(hourly)/60) % 60 )|int }}</span>
                      <span class="info-box-text">{{translation.leave[language]}}</span>
                    </div>
                </div>
            </div>
            <div class="col-xl-4">
                <div class="info-box pull-up">
                  <span class="info-box-icon bg-primary-light rounded-circle">
                    <i class="fas fa-hand-holding-usd mt-4"></i>
                  </span>
                  {% set amounts=[] %}
                  {% if employee %}
                    {% for loan in employee.loans.filter_by(presidency=1, finance=1).all() %}
                      {% if amounts.append((loan.requested_amount)) %}{% endif %}
                    {% endfor %}
                  {% endif %}
                  <div class="info-box-content text-right">
                    <span class="info-box-number">{{ sum(amounts) }}</span>
                    <span class="info-box-text">{{translation.loan[language]}}</span>
                  </div>
                </div>
            </div>
        </div>
        <div class="box">
          <div class="col-12">
            <div class="box box-default">
              <div class="box-header with-border">
                <h4 class="box-title text-primary font-weight-bold ">{{translation.employee_profile[language]}}</h4>
              </div>
              <!-- /.box-header -->
                <div class="box-body">
                <ul id="tabs" class="nav nav-tabs nav-fill" role="tablist">
                    <li class="nav-item">
                      <a class="nav-link border-bottom border-radius-top active" data-toggle="tab" href="#personal_info" role="tab">
                        <span>{{translation.personal_information[language]}}</span>
                      </a>
                    </li>
                    <li class="nav-item">
                      <a class="nav-link border-bottom" data-toggle="tab" href="#addresses" role="tab">
                        <span>{{translation.address[language]}}</span>
                      </a>
                    </li>
                    <li class="nav-item">
                      <a class="nav-link border-bottom" data-toggle="tab" href="#documents" role="tab">
                        <span>{{translation.documents[language]}}</span>
                      </a>
                    </li>
                    
                    <li class="nav-item">
                      <a class="nav-link border-bottom" data-toggle="tab" href="#contract" role="tab">
                        <span>{{translation.contract[language]}}</span>
                      </a>
                    </li>
                    <li class="nav-item">
                      <a class="nav-link border-bottom" data-toggle="tab" href="#change-pass" role="tab">
                        <span>{{translation.change_pass[language]}}</span>
                      </a>
                    </li>
                </ul>
                <!-- Tab panes -->
                <div class="tab-content mt-4">
                    <div class="tab-pane active" id="personal_info" role="tabpanel">
                      <div class="row">
                        <div class="col-md-6">
                          <div class="box border-radius">
                            <div class="box-body">
                              <h4>نام به دری</h4>
                              <div class="bg-white pt-2">
                                <div class="media-body m-1 p-1 bb-1">
                                    <span>نام</span>
                                    <strong class="float-right">
                                    {{ employee.name }}
                                    </strong>
                                </div>
                              </div>
                              <div class="bg-white pt-2">
                                <div class="media-body m-1 p-1 bb-1">
                                    <span>تخلص</span>
                                    <strong class="float-right">
                                    {{ employee.lname }}
                                    </strong>
                                </div>
                              </div>
                              <div class="bg-white pt-2">
                                <div class="media-body m-1 p-1 bb-1">
                                    <span>نام پدر</span>
                                    <strong class="float-right">
                                    {{ employee.fname }}
                                    </strong>
                                </div>
                              </div>
                              <div class="bg-white pt-2">
                                <div class="media-body m-1 p-1 bb-1">
                                    <span>نام پدر کلان</span>
                                    <strong class="float-right">
                                    {{ employee.gname }}
                                    </strong>
                                </div>
                              </div>
                            </div>
                          </div>
                        </div>
                        <div class="col-md-6">
                          <div class="box border-radius">
                            <div class="box-body">
                              <h4>Name in English</h4>
                              <div class="bg-white pt-2">
                                <div class="media-body m-1 p-1 bb-1">
                                    <span>First Name</span>
                                    <strong class="float-right">
                                    {{ employee.name_english }}
                                    </strong>
                                </div>
                              </div>
                              <div class="bg-white pt-2">
                                <div class="media-body m-1 p-1 bb-1">
                                    <span>Last Name</span>
                                    <strong class="float-right">
                                    {{ employee.lname_english }}
                                    </strong>
                                </div>
                              </div>
                              <div class="bg-white pt-2">
                                <div class="media-body m-1 p-1 bb-1">
                                    <span>Father Name</span>
                                    <strong class="float-right">
                                    {{ employee.fname_english }}
                                    </strong>
                                </div>
                              </div>
                              <div class="bg-white pt-2">
                                <div class="media-body m-1 p-1 bb-1">
                                    <span>Grand Father Name</span>
                                    <strong class="float-right">
                                    {{ employee.gname_english }}
                                    </strong>
                                </div>
                              </div>
                            </div>
                          </div>
                        </div>
                      </div>
                      <div class="box border-radius">
                        <div class="box-body">
                          <div class="row">
                            <div class="col-md-6">
                              <div class="bg-white pt-2">
                                <div class="media-body m-1 p-1 bb-1">
                                    <span>{{ translation.tazkira[language] }}</span>
                                    <strong class="float-right">
                                    {{ employee.tazkira }}
                                    </strong>
                                </div>
                              </div>
                            </div>
                            <div class="col-md-6">
                              <div class="bg-white pt-2">
                                <div class="media-body  m-1 p-1 bb-1">
                                    <span>{{ translation.tin[language] }}</span>
                                    <strong class="float-right">
                                    {{ employee.tin }}
                                    </strong>
                                </div>
                              </div>
                            </div>
                            <div class="col-md-6">
                              <div class="bg-white pt-2">
                                <div class="media-body  m-1 p-1 bb-1">
                                    <span>{{ translation.birthday[language] }}</span>
                                    <strong class="float-right">
                                    {{ to_jalali(employee.birthday) }}
                                    </strong>
                                </div>
                              </div>
                            </div>
                            <div class="col-md-6">
                              <div class="bg-white pt-2">
                                <div class="media-body  m-1 p-1 bb-1">
                                    <span>{{ translation.blood_group[language] }}</span>
                                    <strong class="float-right">
                                    {{ employee.blood }}
                                    </strong>
                                </div>
                              </div>
                            </div>
                            <div class="col-md-6">
                              <div class="bg-white pt-2">
                                <div class="media-body  m-1 p-1 bb-1">
                                    <span>{{ translation.gender[language] }}</span>
                                    <strong class="float-right">
                                    {% if employee.gender == true %}
                                      {{translation.male[language]}}
                                    {% else %}
                                      {{translation.female[language]}}
                                    {% endif %}
                                    </strong>
                                </div>
                              </div>
                            </div>
                            <div class="col-md-6">
                              <div class="bg-white pt-2">
                                <div class="media-body  m-1 p-1 bb-1">
                                    <span>{{ translation.m_status[language] }}</span>
                                    <strong class="float-right">
                                      {% if employee.m_status == True %}
                                        {{translation.married[language]}}
                                      {% else %}
                                        {{translation.single[language]}}
                                      {% endif %}
                                    </strong>
                                </div>
                              </div>
                            </div>
                            <div class="col-md-6">
                              <div class="bg-white pt-2">
                                <div class="media-body overflow-auto m-1 p-1 bb-1">
                                    <span>{{ translation.phone[language] }}</span>
                                    <strong class="float-right text-left">
                                      {% for phone in employee.phones %}
                                        {{ phone.phone }}<br>
                                      {% endfor %}
                                    </strong>
                                </div>
                              </div>
                            </div>
                            <div class="col-md-6">
                              <div class="bg-white pt-2">
                                <div class="media-body overflow-auto mb-1 py-1 bb-1">
                                    <span>{{ translation.email[language] }}</span>
                                    <strong class="float-right text-left">
                                      {% for email in employee.emails %}
                                        {{ email.email }}<br>
                                      {% endfor %}
                                    </strong>
                                </div>
                              </div>
                            </div>
                          </div>
                        </div>
                      </div>
                    </div>
                    <div class="tab-pane" id="addresses" role="tabpanel">
                      <div class="row">
                        <div class="col-md-6">
                          <div class="box border-radius">
                            <div class="box-body">
                              <h4>{{ translation.current_address[language] }}</h4>
                              <div class="bg-white pt-2">
                                <div class="media-body m-1 p-1 bb-1">
                                    <span>{{ translation.provinces[language] }}</span>
                                    <strong class="float-right">
                                      {% if employee.current_address %}
                                        {{ employee.current_address.province.province_name }}
                                      {% endif %}
                                    </strong>
                                </div>
                              </div>
                              <div class="bg-white pt-2">
                                <div class="media-body m-1 p-1 bb-1">
                                    <span>{{ translation.district[language] }}</span>
                                    <strong class="float-right">
                                      {% if employee.current_address %}
                                        {{ employee.current_address.district.district_name }}
                                      {% endif %}
                                    </strong>
                                </div>
                              </div>
                              <div class="bg-white pt-2">
                                <div class="media-body m-1 p-1 bb-1">
                                    <span>Address</span>
                                    <strong class="float-right">
                                      {% if employee.current_address %}
                                        {{ employee.current_address.address }}
                                      {% endif %}
                                    </strong>
                                </div>
                              </div>
                              <div class="bg-white pt-2">
                                <div class="media-body m-1 p-1 bb-1">
                                    <span>آدرس</span>
                                    <strong class="float-right">
                                      {% if employee.current_address %}
                                        {{ employee.current_address.address_dari }}
                                      {% endif %}
                                    </strong>
                                </div>
                              </div>
                            </div>
                          </div>
                        </div>
                        <div class="col-md-6">
                          <div class="box border-radius">
                            <div class="box-body">
                              <h4>{{ translation.permanent_address[language] }}</h4>
                              <div class="bg-white pt-2">
                                <div class="media-body m-1 p-1 bb-1">
                                    <span>{{ translation.provinces[language] }}</span>
                                    <strong class="float-right">
                                      {% if employee.permanent_address %}
                                        {{ employee.permanent_address.province.province_name }}
                                      {% endif %}
                                    </strong>
                                </div>
                              </div>
                              <div class="bg-white pt-2">
                                <div class="media-body m-1 p-1 bb-1">
                                    <span>{{ translation.district[language] }}</span>
                                    <strong class="float-right">
                                      {% if employee.permanent_address %}
                                        {{ employee.permanent_address.district.district_name }}
                                      {% endif %}
                                    </strong>
                                </div>
                              </div>
                              <div class="bg-white pt-2">
                                <div class="media-body m-1 p-1 bb-1">
                                    <span>Address</span>
                                    <strong class="float-right">
                                      {% if employee.permanent_address %}
                                        {{ employee.permanent_address.address }}
                                      {% endif %}
                                    </strong>
                                </div>
                              </div>
                              <div class="bg-white pt-2">
                                <div class="media-body m-1 p-1 bb-1">
                                    <span>آدرس</span>
                                    <strong class="float-right">
                                      {% if employee.permanent_address %}
                                        {{ employee.permanent_address.address_dari }}
                                      {% endif %}
                                    </strong>
                                </div>
                              </div>
                            </div>
                          </div>
                        </div>
                      </div>
                    </div>
                    <div class="tab-pane" id="documents" role="tabpanel">
                      <div class="row">
                        {% if employee.documents %}
                          {% for document in employee.documents %}
                          <div class="col-md-3">
                            <div class="box p-1">
                                <span>
                                  <h4 class="pull-left px-2 mt-1">
                                    {% if document.name == 'cv' %}
                                      {{translation.cv[language]}}
                                    {% elif document.name == 'guarantor' %}
                                      {{translation.guarantors[language]}}
                                    {% elif document.name == 'education' %}
                                      {{translation.educational_documents[language]}}
                                    {% elif document.name == 'tin' %}
                                      {{translation.tin[language]}}
                                    {% elif document.name == 'tazkira' %}
                                      {{translation.copy_of_national_id[language]}}
                                    {% elif document.name == 'extra_docs' %}
                                      {{translation.other_document[language]}}
                                    {% endif %}
                                  </h4>
                                  <a href="{{document.url}}" class="btn btn-xs"><button type="button" class="waves-effect waves-light btn btn-xs btn-circle btn-info"><i class="fa fa-download"></i></button></a>
                                </span>
                              </div>
                          </div>
                          {% endfor %}
                        {% else %}
                          <div class="col-md-12 text-center">
                            {{translation.no_document_uploaded[language]}}
                          </div>
                        {% endif %}
                      </div>
                    </div>
                    <div class="tab-pane" id="contract" role="tabpanel">
                      <div class="row">
                        {% for contract in employee.position_history.order_by(Position_history.status.desc()).all() %}
                          <div class="box border-radius">
                            <div class="box-header pt-4 pb-2">
                              <h4 class="box-title">
                                {% if language == 'dari' %}
                                  {{contract.position.name}}
                                {% else %}
                                  {{contract.position.name_english}}
                                {% endif %}
                                {% if contract.status %}
                                  ({{ (contract.end_date - date.today()).days }} {{translation.day[language]}})
                                {% endif %}
                              </h4>
                              <div class="pull-right">
                                {% if contract.status %}
                                  <small class="badge bg-success">
                                    {{translation.active[language]}}
                                  </small>
                                {% else %}
                                  <small class="badge bg-secondary">
                                    {{translation.inactive[language]}}
                                  </small>
                                {% endif %}
                              </div>
                            </div>
                    
                            <div class="box-body">
                              <div class="row">
                                <div class="col-md-6">
                                  <div class="bg-white pt-2">
                                    <div class="media-body overflow-auto m-1 p-1 bb-1">
                                        <span>{{ translation.contract_type[language] }}</span>
                                        <strong class="float-right text-left">
                                          {% if contract.contract_type %}
                                            {% if language == 'dari' %}
                                              {{ contract.contract_type.name }}
                                            {% else %}
                                              {{ contract.contract_type.name_english }}
                                            {% endif %}
                                          {% endif %}
                                        </strong>
                                    </div>
                                  </div>
                                </div>
                                <div class="col-md-6">
                                  <div class="bg-white pt-2">
                                    <div class="media-body overflow-auto m-1 p-1 bb-1">
                                        <span>{{ translation.position[language] }}</span>
                                        <strong class="float-right text-left">
                                          {% if contract.position %}
                                            {% if language == 'dari' %}
                                              {{ contract.position.name }}
                                            {% else %}
                                              {{ contract.position.name_english }}
                                            {% endif %}
                                          {% endif %}
                                        </strong>
                                    </div>
                                  </div>
                                </div>
                                <div class="col-md-6">
                                  <div class="bg-white pt-2">
                                    <div class="media-body overflow-auto m-1 p-1 bb-1">
                                        <span>{{ translation.department[language] }}</span>
                                        <strong class="float-right text-left">
                                          {% if contract.department %}
                                            {% if language == 'dari' %}
                                              {{ contract.department.name }}
                                            {% else %}
                                              {{ contract.department.name_english }}
                                            {% endif %}
                                          {% endif %}
                                        </strong>
                                    </div>
                                  </div>
                                </div>
                                <div class="col-md-6">
                                  <div class="bg-white pt-2">
                                    <div class="media-body overflow-auto m-1 p-1 bb-1">
                                        <span>{{ translation.start_date[language] }}</span>
                                        <strong class="float-right text-left">
                                          {{ to_jalali(contract.start_date) }}
                                        </strong>
                                    </div>
                                  </div>
                                </div>
                                <div class="col-md-6">
                                  <div class="bg-white pt-2">
                                    <div class="media-body overflow-auto m-1 p-1 bb-1">
                                        <span>{{ translation.end_date[language] }}</span>
                                        <strong class="float-right text-left">
                                          {{ to_jalali(contract.end_date) }}
                                        </strong>
                                    </div>
                                  </div>
                                </div>
                                <div class="col-md-6">
                                  <div class="bg-white pt-2">
                                    <div class="media-body overflow-auto m-1 p-1 bb-1">
                                        <span>{{ translation.base_salary[language] }}</span>
                                        <strong class="float-right text-left">
                                          {% if contract.salary %}
                                            {{contract.salary.base }}
                                          {% endif %}
                                        </strong>
                                    </div>
                                  </div>
                                </div>
                                <div class="col-md-6">
                                  <div class="bg-white pt-2">
                                    <div class="media-body overflow-auto m-1 p-1 bb-1">
                                        <span>{{ translation.transportation[language] }}</span>
                                        <strong class="float-right text-left">
                                          {% if contract.salary %}
                                            {{contract.salary.transportation }}
                                          {% endif %}
                                        </strong>
                                    </div>
                                  </div>
                                </div>
                                <div class="col-md-6">
                                  <div class="bg-white pt-2">
                                    <div class="media-body overflow-auto m-1 p-1 bb-1">
                                        <span>{{ translation.house_hold[language] }}</span>
                                        <strong class="float-right text-left">
                                          {% if contract.salary %}
                                            {{contract.salary.house_hold }}
                                          {% endif %}
                                        </strong>
                                    </div>
                                  </div>
                                </div>
                                <div class="col-md-6">
                                  <div class="bg-white pt-2">
                                    <div class="media-body overflow-auto m-1 p-1 bb-1">
                                        <span>{{ translation.currency[language] }}</span>
                                        <strong class="float-right text-left">
                                          {% if contract.salary %}
                                            {% if contract.salary.currency == "1"%}
                                              {{translation.afghani[language]}}
                                            {% else %}
                                              {{translation.dollar[language]}}
                                            {% endif %}
                                          {% endif %}
                                        </strong>
                                    </div>
                                  </div>
                                </div>
                                <div class="col-md-6">
                                  <div class="bg-white pt-2">
                                    <div class="media-body overflow-auto m-1 p-1 bb-1">
                                        <span>{{ translation.contract_duration[language] }}</span>
                                        <strong class="float-right text-left">
                                          {% set num_months = (contract.end_date.year - contract.start_date.year) * 12 + (contract.end_date.month - contract.start_date.month) %}
                                          {% if num_months == 0 %}
                                            {{translation.less_then_a_month[language]}}
                                          {% else %}
                                            {{ num_months }} {{translation.months[language]}}
                                          {% endif %}
                                        </strong>
                                    </div>
                                  </div>
                                </div>
                              </div>
                            </div>
                          </div>
                        {% endfor %}
                      </div>
                    </div>
                    <div class="tab-pane" id="change-pass" role="tabpanel">
                      <div class="row">
                        <div class="col-md-8 offset-md-2 box">
                          <div class="box-body">
                            <div class="my-1 text-center">
                              <div class="font-weight-bold">{{translation.change_pass_form[language]}}</div>
                            </div>
                            <form method="POST" , action="change_password">
                              {{ change_pass_form.hidden_tag()}}
                              <div class="form-group">
                                {{ change_pass_form.old_pass.label(class="form-control-label")}}
                                <div class="input-group icon-pointer">
                                  {{ change_pass_form.old_pass(type="password", class="form-control form-control-lg")}}
                                  <div id="old_pass_prepend" class="input-group-prepend">
                                      <span class="{{ 'border-radius-dari' if language == 'dari' else 'border-radius-en' }} input-group-text bg-transparent">
                                          <i id="old_pass_icon" class="fad fa-eye-slash"></i>
                                      </span>
                                  </div>
                                </div>
                              </div>
                              <div class="form-group">
                                {{ change_pass_form.new_pass.label(class="form-control-label")}}
                                <div class="input-group icon-pointer">
                                  {{ change_pass_form.new_pass(type="password", class="form-control form-control-lg")}}
                                  <div id="new_pass_prepend" class="input-group-prepend">
                                      <span class="{{ 'border-radius-dari' if language == 'dari' else 'border-radius-en' }} input-group-text bg-transparent">
                                          <i id="new_pass_icon" class="fad fa-eye-slash"></i>
                                      </span>
                                  </div>
                                </div>
                              </div>
                              <div class="form-group">
                                {{ change_pass_form.confirm_pass.label(class="form-control-label")}}
                                {{ change_pass_form.confirm_pass(type="password", class="form-control form-control-lg")}}
                              </div>
                              <div class="form-group">
                                {{ change_pass_form.submit(class="btn btn-primary")}}
                              </div>
                            </form>
                          </div>
                        </div>
                      </div>
                    </div>
                </div>
              </div>
              <!-- /.box-body -->
            </div>
            <!-- /.box -->
          </div>
        </div>
      </div>
      <div class="col-xl-3 col-12">
        <div class="box">
          <div class="box-body text-center">
              <div class="mb-20 mt-20">
                  <form id="upload_profile_pic" enctype="multipart/form-data">
                      <input type="file" onchange="uploadProfile()" name="profilePic">
                  </form>
                  <img src="{{ employee.profile_pic }}" onerror="this.onerror=null; this.src='/static/images/avatar.png'" width="150" class="rounded-circle bg-info-light" alt="user">
                  <h3 class="mt-10">
                    {% if language == 'dari' %}
                      {{employee.name}} {{employee.lname}}
                    {% else %}
                      {{employee.name_english}} {{employee.lname_english}}
                    {% endif %}
                  </h3>
                  <h4>{{employee.id}}</h4>
              </div>
          </div>
      </div>
   </div>
  </div>
</section>
{% endblock main_content%}
{% block js_code %}
{% with messages = get_flashed_messages(with_categories=true) %}
  {%if messages %}
    {%for category, message in messages %}
    <!-- <div class="alert alert-{{category}}"> {{message}} </div> -->
    <script>
        $(document).ready(function() {
            var message = JSON.parse('{{ message | tojson | safe}}');
            if("{{category}}" == "success")
                toastSuccess(message)
            else
                toastError(formValidationDisplay(message))
        }); 
        
    </script>
    {% endfor %}
  {% endif %}
{% endwith %}

<script>
  function uploadProfile(){
    $form = $("#upload_profile_pic");
    var formData = new FormData($form[0]);
    $.ajax({
        type: "POST",
        url: "upload_profile_pic",
        data: formData,
        processData: false,
        contentType: false,
        success: function (response) {
          if(response == "success")
            location.reload()
            toastSuccess(response);
        },
        error: function (response) {
            var statusCode = response.status;
            var r = '';
            if (statusCode == '403') {
                r = formValidateErrors(response);
            }
            toastError(r);
        }
    });
  }
  
$(document).ready(function() {
  var old_pass = false;
  $('#old_pass_prepend').click(function (e) {
    if(old_pass){
      $('#old_pass_icon').removeClass('fa-eye').addClass('fa-eye-slash');
      $('#old_pass').attr('type', 'password');
    }
    else{
      $('#old_pass_icon').removeClass('fa-eye-slash').addClass('fa-eye');
      $('#old_pass').attr('type', 'text');
    }
    old_pass = !old_pass;
  });

  var new_pass = false;
  $('#new_pass_prepend').click(function (e) {
    if(new_pass){
      $('#new_pass_icon').removeClass('fa-eye').addClass('fa-eye-slash');
      $('#new_pass').attr('type', 'password');
      $('#confirm_pass').attr('type', 'password');
    }
    else{
      $('#new_pass_icon').removeClass('fa-eye-slash').addClass('fa-eye');
      $('#new_pass').attr('type', 'text');
      $('#confirm_pass').attr('type', 'text');
    }
    new_pass = !new_pass;
  });


    
});
</script>
{% endblock js_code %}